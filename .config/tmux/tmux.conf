#### CORE SETTINGS #########################################
# Use Ctrl-A as prefix (instead of Ctrl-B)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Start windows & panes at 1 (not 0)
set -g base-index 1
setw -g pane-base-index 1

# Enable mouse support
set -g mouse on

# True-color support
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",xterm*:Tc"

# Clipboard (OSC52 over SSH)
set-option -g set-clipboard on

# Aggressive pane resizing (better layout when one pane changes)
set -g aggressive-resize on

#### PLUGINS #######################################
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tpm'

#### Switch-session ######################################
bind o display-popup -B -E "~/.config/tmux/cmd/switch" # run custom switcher
bind g display-popup -B -E -w 100% -h 100% "zsh -i -c gdiff" # open gdiff function on .zshrc

#### KEY BINDINGS #########################################
# Pane resizing with Shift+H/L (5 cells)
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r K resize-pane -U 5
bind -r J resize-pane -D 5

# vim bindings for pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind Tab last-window           # prefix + Tab (very intuitive!)
bind BTab switch-client -l     # prefix + Shift+Tab for last session

# Move windows left/right in status bar
bind -r C-h swap-window -t -1\; select-window -t -1
bind -r C-l swap-window -t +1\; select-window -t +1

# Resize equally
bind = select-layout -E

# toggle status bar
bind-key c-s set-option status

# Split panes in current path
bind '-' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window     -c "#{pane_current_path}"

# Move current pane to new window
bind ! break-pane

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \;

#### COPY MODE (vi) #######################################
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

#### THEME #####################################
set -g status-left-length 80
set -g status-right-length 200
set -g status-interval 5
set -g status-left ""
set -g status-right ""

##### Palette (Catppuccin Mocha) ###############################################
set -g @thm_bg        "#1e1e2e"
set -g @thm_fg        "#cdd6f4"
set -g @thm_mauve     "#cba6f7"
set -g @thm_crust     "#11111b"
set -g @thm_surface_0 "#313244"
set -g @thm_green     "#a6e3a1"
set -g @thm_yellow    "#f9e2af"
set -g @thm_red       "#f38ba8"
set -g @thm_sky       "#89dceb"
set -g @thm_rosewater "#f5e0dc"

##### Window Styling ############################################################
setw -g window-status-format "#[bg=#{@thm_surface_0},fg=#{@thm_fg}] #I:#W #[default]"
setw -g window-status-current-format "#[bg=#{@thm_mauve},fg=#{@thm_crust},bold] #I:#W #[default]"
setw -g window-status-separator "#[fg=#3a3a4a]│#[default]"

##### Status Bar ################################################################
set -g status-style "bg=#{@thm_bg},fg=#{@thm_fg}"

##### Dynamic CPU & RAM colors ##################################################
set -g @cpu_low_bg_color    "#[bg=#{@thm_green}]"
set -g @cpu_medium_bg_color "#[bg=#{@thm_yellow}]"
set -g @cpu_high_bg_color   "#[bg=#{@thm_red}]"

set -g @ram_low_bg_color    "#[bg=#{@thm_green}]"
set -g @ram_medium_bg_color "#[bg=#{@thm_yellow}]"
set -g @ram_high_bg_color   "#[bg=#{@thm_red}]"

##### Status Right Content ######################################################

set -g status-right '#{cpu_bg_color} #[fg=#{@thm_crust}]󰻠 #{cpu_percentage} #[default]'
set -ag status-right ' #{ram_bg_color} #[fg=#{@thm_crust}]󰍛 #{ram_percentage} #[default]'
set -ag status-right ' #[bg=#{@thm_sky}] #[fg=#{@thm_crust}]󰲋 #S #[default]'
# get current kube context
if-shell "command -v kubectl >/dev/null 2>&1" \
  "set -ag status-right '#[bg=default] #[bg=#{@thm_rosewater}] #[fg=#{@thm_crust}]☸ #(kubectl config current-context) '"

#### INITIALIZE TPM ########################################
run '~/.config/tmux/plugins/tpm/tpm'
run-shell "~/.config/tmux/plugins/tpm/bin/install_plugins"
